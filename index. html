<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Stock Trainer</title>
<style>
body { font-family: Arial; margin:0; background:#f5f7fb; }
header { background:#2b2b2b; color:white; padding:15px; text-align:center; }
main { padding:20px; max-width:1000px; margin:auto; }
.search { display:flex; margin-bottom:15px; }
.search input { flex:1; padding:10px; font-size:16px; }
.search button { padding:10px 15px; font-size:16px; }
#chartContainer { width:100%; height:500px; margin-bottom:20px; }
.info { background:white; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
</style>
</head>
<body>

<header><h1>Live Stock Trainer</h1></header>

<main>
<div class="search">
<input type="text" id="symbolInput" placeholder="Enter Symbol (e.g., AAPL)">
<button id="loadBtn">Load Stock</button>
</div>

<div id="chartContainer"></div>

<div class="info" id="companyInfo">
<h2>Company Info</h2>
<div id="infoContent">Search a stock to see info</div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
const API_KEY = "c933f15065e54a7b9d8908b084d72de1";

// Wait for the DOM and TradingView script to load
document.getElementById("loadBtn").addEventListener("click", async function() {
  const symbol = document.getElementById("symbolInput").value.trim();
  if(!symbol) return alert("Enter a symbol");

  // Remove old chart container content
  document.getElementById('chartContainer').innerHTML = "";

  // Create a new div for the chart
  const chartDiv = document.createElement("div");
  chartDiv.id = "tv_chart";
  chartDiv.style.height = "500px";
  document.getElementById('chartContainer').appendChild(chartDiv);

  // Load TradingView widget
  new TradingView.widget({
    width: "100%",
    height: 500,
    symbol: symbol,
    interval: "1",
    timezone: "Asia/Kolkata",
    theme: "light",
    style: "1",
    locale: "en",
    container_id: "tv_chart",
    enable_publishing: false,
    allow_symbol_change: true
  });

  // Fetch fundamentals from Twelve Data
  try {
    const res = await fetch(`https://api.twelvedata.com/fundamental?symbol=${symbol}&apikey=${API_KEY}`);
    const data = await res.json();
    if(data.status==="error") {
      document.getElementById('infoContent').innerText = data.message;
    } else {
      document.getElementById('infoContent').innerHTML = `
        <p><b>Name:</b> ${data.name}</p>
        <p><b>Exchange:</b> ${data.exchange}</p>
        <p><b>Sector:</b> ${data.sector}</p>
        <p><b>Market Cap:</b> ${data.market_cap}</p>
        <p><b>P/E Ratio:</b> ${data.pe_ratio}</p>
      `;
    }
  } catch(err) {
    document.getElementById('infoContent').innerText = "Failed to load company info";
  }
});
</script>

</body>
</html>
